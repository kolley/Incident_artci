generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* ===========================
   TABLE : OPERATEUR
   =========================== */
model Operateur {
  id_operateur   Int           @id 
  nom_operateur  String        @unique   // ⚠️ modifié
  description    String?
  users          User[]
  formulaires    Formulaire[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}



/* ===========================
   TABLE : PROFIL
   =========================== */
model Profil {
  id_Profil    String     @id
  nom_profil   String
  description  String?
  users        User[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

/* ===========================
   TABLE : USER
   =========================== */
model User {
  id_user         Int         @id @default(autoincrement())
  email           String      @unique
  password        String
  nom_user        String
  id_operateur    Int?
  nom_operateur   Operateur?  @relation(fields: [id_operateur], references: [id_operateur])
  id_Profil       String?
  nom_profil      Profil?     @relation(fields: [id_Profil], references: [id_Profil])
  formulaires     Formulaire[]
  notifications   Notification[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

/* ===========================
   TABLE : FORMULAIRE
   =========================== */
model Formulaire {
  id_formulaire   Int          @id @default(autoincrement())
  id_user         Int
  user            User         @relation(fields: [id_user], references: [id_user])

  id_operateur    Int
  operateur       Operateur    @relation(fields: [id_operateur], references: [id_operateur]) // ⚠️ conserve le nom mais référence le bon champ

  typeIncident_infrastructure   String
  typeIncident_zone  String
  typeIncident_abonne  String

  reference       String?
  intitule        String
  descriptif      String
  zone            String
  localite        String
  communes        String
  abonnesimpactes Int
  noeudsTouches   Int
  impacts         String
  resolution      String

  dateNotification DateTime
  dateDebut        DateTime?
  dateFin          DateTime?
  observation      String?

  etat             String
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

/* ===========================
   TABLE : NOTIFICATION
   =========================== */
model Notification {
  id_notification Int      @id @default(autoincrement())
  id_user         Int
  user            User     @relation(fields: [id_user], references: [id_user])
  message         String?
  dateMessage     DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
